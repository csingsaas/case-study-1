!function(a,b,c,d){"use strict";var e,f,g,h=5e3,i=0,j=function(){if((null==e||null==f)&&(i+=10,i<h))return setTimeout(j,10),!1;var k=c.Model.extend({idAttribute:"itemId"}),l=c.Collection.extend({pending:!0,model:k,initialize:function(){var a=this,b=function(b,c){var d=c.Items;d.length&&a.reset(d)};d.subscribe("Item.Results.Complete",b)}}),m=c.View.extend({el:a("#productListContainer"),templatePath:"/templates/product-list-container.html",events:{},initialize:function(){var a=this,b=function(b,c){"Route.Default"===b?(a.$el.removeClass("hidden"),a.setPageTitle()):a.$el.addClass("hidden")};d.subscribe("Route",b),g=new l,g.on("reset",this.renderListItems,this),e.GetItems(),this.render()},template:function(){return f.GetTemplate(this.templatePath)},render:function(){var a=this;this.$el.html(a.template())},renderListItems:function(){new n({el:a("#productList"),items:g});new o},setPageTitle:function(){document.title="Product Listing"}}),n=c.View.extend({templatePath:"/templates/product-list.html",items:[],events:{},initialize:function(a){a.items&&a.items.models&&(this.items=a.items.models,this.render())},template:function(){return f.GetTemplate(this.templatePath,{Items:this.items})},render:function(){var a=this;this.$el.html(a.template())}}),o=c.View.extend({el:a("#productDetail"),quantity:1,item:null,templatePath:"/templates/product-detail.html",events:{"click .js-quantity-minus":"quantityDeduct","click .js-quantity-plus":"quantityAdd"},initialize:function(){var a=this,b=function(b,c){"Route.Item"===b?(a.$el.removeClass("hidden"),a.item=a.convertItem(g.get(c.Id)),a.setPageTitle(),a.render()):a.$el.addClass("hidden")};d.subscribe("Route",b)},template:function(){return f.GetTemplate(this.templatePath,{Item:this.item})},render:function(){var a=this;this.$el.html(a.template());new p({el:this.$el.find(".js-item-images"),Item:a.item})},convertItem:function(a){var c={};c.title=a.get("title"),c.purchasingChannel=parseInt(a.get("purchasingChannelCode")),c.images=[];var d=a.get("Images");d.length>0&&(d[0].PrimaryImage.length>0&&c.images.push(d[0].PrimaryImage[0].image),d[0].AlternateImages.length>0&&b.each(d[0].AlternateImages,function(a){c.images.push(a.image)})),c.promotions=[];var e=a.get("Promotions");e.length>0&&b.each(e,function(a){a.Description.length>0&&b.each(a.Description,function(a){c.promotions.push(a.shortDescription)})}),c.price=null,c.priceQualifier=null;var f=a.get("Offers");f.length>0&&f[0].OfferPrice.length>0&&(c.price=f[0].OfferPrice[0].formattedPriceValue,c.priceQualifier=f[0].OfferPrice[0].priceQualifier),c.features=[];var g=a.get("ItemDescription");g.length>0&&g[0].features.length>0&&b.each(g[0].features,function(a){c.features.push(a)}),c.starRating=null,c.totalReviews=null,c.proReview={},c.conReview={};var h=a.get("CustomerReview");if(h.length>0){var i=h[0];if(c.starRating=parseInt(i.consolidatedOverallRating),c.totalReviews=parseInt(i.totalReviews),i.Con.length>0){var j=i.Con[0];c.conReview.rating=parseInt(j.overallRating),c.conReview.title=j.title,c.conReview.by=j.screenName,c.conReview.date=j.datePosted,c.conReview.review=j.review}if(i.Pro.length>0){var k=i.Pro[0];c.proReview.rating=parseInt(k.overallRating),c.proReview.title=k.title,c.proReview.by=k.screenName,c.proReview.date=k.datePosted,c.proReview.review=k.review}}return c},setPageTitle:function(){this.item&&(document.title=this.item.title)},quantityDeduct:function(){this.quantity>1&&(this.quantity--,this.$el.find(".js-quantity").text(this.quantity))},quantityAdd:function(){this.quantity++,this.$el.find(".js-quantity").text(this.quantity)}}),p=c.View.extend({item:{},images:[],lastImage:null,nextEnabled:!1,previousEnabled:!1,nextContainer:".js-next-thumbnail",previousContainer:".js-previous-thumbnail",currentContainer:".js-active-thumbnail",currentImage:null,nextImage:null,previousImage:null,templatePath:"/templates/image-carousel.html",events:{"click .js-next-image":"nextImage","click .js-previous-image":"previousImage"},initialize:function(a){a.Item&&(this.item=a.Item),a.Item.images&&(this.images=a.Item.images,this.lastImage=this.images.length-1,this.images.length>0&&(this.currentImage=0,this.images.length>1&&(this.nextEnabled=!0,this.nextImage=1),this.images.length>2&&(this.previousEnabled=!0,this.previousImage=this.images.length-1))),this.render()},template:function(){return f.GetTemplate(this.templatePath,{Images:this.images,Item:this.item})},render:function(){var a=this;this.$el.html(a.template()),this.setThumbnails()},setThumbnails:function(){this.$el.find(this.currentContainer).html("<img src='"+this.images[this.currentImage]+"' />"),this.nextEnabled&&(this.$el.find(this.nextContainer+" button").html("<img src='"+this.images[this.nextImage]+"' />"),this.$el.find(this.nextContainer).removeClass("hidden")),this.previousEnabled&&(this.$el.find(this.previousContainer+" button").html("<img src='"+this.images[this.previousImage]+"' />"),this.$el.find(this.previousContainer).removeClass("hidden")),this.setLargeImage()},setLargeImage:function(){this.$el.find(".js-large-image").prop("src",this.images[this.currentImage])},nextImage:function(){this.currentImage+1>this.lastImage?(this.currentImage=0,this.lastImage>0&&(this.nextImage=1,this.lastImage>1&&(this.previousImage=this.lastImage))):this.currentImage+1==this.lastImage?(this.currentImage=this.lastImage,this.nextImage=0,this.lastImage>1&&(this.previousImage=this.currentImage-1)):(this.currentImage=this.currentImage+1,this.nextImage=this.nextImage+1,this.lastImage>1&&(this.previousImage=this.currentImage-1)),this.setThumbnails()},previousImage:function(){this.currentImage-1<0?(this.currentImage=this.lastImage,this.lastImage>0&&(this.nextImage=0,this.lastImage>1&&(this.previousImage=this.currentImage-1))):this.currentImage-1==0?(this.currentImage=0,this.lastImage>0&&(this.nextImage=1,this.lastImage>1&&(this.previousImage=this.lastImage))):(this.currentImage=this.currentImage-1,this.previousImage=this.currentImage-1,this.lastImage>1&&(this.nextImage=this.currentImage+1)),this.setThumbnails()}});new m;d.publish("Router.Init")};j();var k=function(a,b){switch(a){case"Service.Init.Item":e=b.Service;break;case"Service.Init.Template":f=b.Service}};d.subscribe("Service.Init",k)}($,_,Backbone,PubSub),function(a){var b=function(c,d){a.unsubscribe(c,b);var e=Backbone.Router.extend({routes:{"item/:id":"itemRoute","*actions":"defaultRoute"},itemRoute:function(b){a.publish("Route.Item",{Id:b})},defaultRoute:function(){a.publish("Route.Default")}});new e;Backbone.history.start()};a.subscribe("Router.Init",b)}(PubSub),function(a,b){var c=function(){var c="/data/item-data.json",d={GetItems:function(){a.getJSON(c,function(c){var d=c.CatalogEntryView,e=[];d instanceof Array&&d.length>0&&a.each(d,function(a,b){e.push(b)}),b.publish("Item.Results.Complete",{Items:e})})}};b.publish("Service.Init.Item",{Service:d})};b.subscribe("Init.ItemService",c)}($,PubSub),function(a,b,c){var d=function(){var d={GetTemplate:function(c,d){var e;return d=d?d:{},a.ajax({url:c,type:"get",async:!1,success:function(a){e=a},error:function(){}}),(e=b.template(e))(d)}};c.publish("Service.Init.Template",{Service:d})};c.subscribe("Init.TemplateService",d)}($,_,PubSub),function(a){"use strict";a.publish("Init.ItemService"),a.publish("Init.TemplateService")}(PubSub);